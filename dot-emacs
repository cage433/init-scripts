;; MELPA AND CUSTOME PACKAGES
(setq custom-file (concat user-emacs-directory "custom.el"))
(load custom-file t)

(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/"))
(package-initialize)
(unless package-archive-contents
  (package-refresh-contents))


;; PACKAGES
(dolist
    (package '(
               ace-window
               anaphora
               evil
               evil-escape
               projectile
               paredit
               rainbow-delimiters
               sly
               solarized-theme
               s
               use-package
               ))
  (unless (package-installed-p package)
    (package-install package)))

(eval-when-compile
  (require 'use-package))

(use-package evil
  :init
  ;; Use ctrl-u for scrolling
  (setq evil-want-C-u-scroll t)         
  ;; Make all modes start in normal state
  (setq evil-emacs-state-modes nil)     
  (setq evil-insert-state-modes nil)
  (setq evil-motion-state-modes nil)
  :config
  (evil-define-key* 'motion 'global
    ";" #'evil-ex
    ":" #'evil-repeat-find-char) 
  (evil-mode 1))


(use-package evil-escape
  :init
  :config
  (setq-default evil-escape-key-sequence "jk")
  (evil-escape-mode 1))

(use-package projectile
  :init
  :config
  (define-key projectile-mode-map (kbd "s-p") 'projectile-command-map)
  (projectile-mode +1))

(use-package sly
  :init
  (add-to-list 'exec-path "/opt/homebrew/bin")
  (setq inferior-lisp-program "sbcl"))


(use-package ace-window
  :init
  :config
  (global-set-key (kbd "M-o") 'ace-window)
  (setq aw-dispatch-always 1))


(use-package anaphora)


;; THEME AND APPEARANCE
(setq inhibit-startup-screen t)
(load-theme 'wombat)

(when (display-graphic-p)
  (tool-bar-mode 0)
  (scroll-bar-mode 0))
(set-face-background 'default "#111")

(set-frame-font "Inconsolata:pixelsize=16:weight=regular:slant=normal:width=normal:spacing=100:scalable=true")

;; TABS
(setq-default indent-tabs-mode nil)
(setq-default tab-always-indent nil)
(setq-default tab-width 2)

;;
;; OTHER
;;

;; may not keep this - means one can move back to previous window display
(winner-mode 1)

;; switch off the bell
(setq ring-bell-function 'ignore)

;; mac specific stuff
(setq mac-command-modifier 'meta
      mac-option-modifier 'super)
(global-set-key (kbd "M-3") '(lambda () (interactive) (insert "#")))

;; other key bindings
(evil-global-set-key 'normal (kbd "<f3>") 'ibuffer)

(defun indent-current-buffer()
  (interactive) (indent-region (point-min) (point-max)))

(evil-global-set-key 'normal (kbd "<f8>") 'indent-current-buffer)

(defun toggle-maximize-buffer () "Toggle maximize buffer"
       (interactive)
       (if (= 1 (length (window-list)))
           (jump-to-register '_) 
         (progn
           (window-configuration-to-register '_)
           (delete-other-windows))))

(evil-global-set-key 'normal (kbd "<f10>") 'toggle-maximize-buffer)

;; edit the link, in particular for .emacs -> dot-emacs
(setq vc-follow-symlinks nil)

